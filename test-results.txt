(vp311) elaine company/eks-gpu â€¹main*â€º Â» python ./run_tests.py 
ğŸš€ EKS NVIDIA TOOLS - TEST RUNNER
============================================================
Testing refactored modules (Phases 2 & 3)
Creating models/__init__.py...
Creating core/__init__.py...
Creating utils/__init__.py...
ğŸ” Checking module structure...
âœ… All required module files found

============================================================
ğŸ§ª RUNNING PHASE 2 MODELS TESTS
============================================================
ğŸ§ª TESTING PHASE 2 MODELS
============================================================

ğŸ“‹ DriverAlignment Basic:
âœ… DriverAlignment creation
âœ… architecture_display property
âœ… is_ami_first_strategy property
âœ… is_container_first_strategy property
âœ… get_container_packages
âœ… get_missing_packages
âŒ DriverAlignment validation: Validation failed: ['Some container packages missing: missing']
âœ… to_dict serialization
âœ… from_dict deserialization

ğŸ“‹ AlignmentRequest:
âœ… AlignmentRequest creation
âœ… AlignmentRequest validation
âœ… Architecture normalization (arm64)
âœ… Architecture normalization (amd64 -> x86_64)
âœ… get_architecture_enum
âœ… AlignmentRequest invalid validation

ğŸ“‹ NodeGroupConfig Basic:
âœ… NodeGroupConfig creation
âœ… NodeGroupConfig basic validation
âœ… set_gpu_defaults ARM64
âœ… set_ami_configuration
âœ… to_aws_cli_format
âœ… to_json serialization

ğŸ“‹ NodeGroupConfigBuilder:
âœ… NodeGroupConfigBuilder creation
âœ… NodeGroupConfigBuilder validation
âœ… NodeGroupConfigBuilder configuration

ğŸ“‹ Template Operations:
âœ… from_template_file
âœ… merge_overrides

ğŸ“‹ Nested Config Objects:
âœ… ScalingConfig validation
âœ… ScalingConfig invalid validation
âœ… UpdateConfig
âœ… Taint validation
âœ… Taint to_dict

============================================================
TEST SUMMARY: 30/31 passed
FAILED TESTS:
  â€¢ DriverAlignment validation: Validation failed: ['Some container packages missing: missing']
============================================================
ğŸ’¥ Some Phase 2 tests failed!

âŒ PHASE 2 MODELS TESTS FAILED (0.1s)

============================================================
ğŸ§ª RUNNING PHASE 3 UTILITIES TESTS
============================================================
ğŸ§ª TESTING PHASE 3 UTILITIES
============================================================

ğŸ“‹ Version Parser:
âœ… Basic version parsing
âœ… Version with suffix parsing
âŒ Driver version parsing: Got 570.148.8
âŒ Clean version extraction: Expected '570.148.08', got '570.148.8'
âŒ Legacy parse_driver_version function: Got '570.148.8'

ğŸ“‹ Version Comparison:
âœ… VersionInfo greater than
âœ… VersionInfo equality
âœ… String version comparison
âœ… Version sorting
âœ… Legacy compare_versions function
âœ… Version compatibility check
âœ… Find latest version

ğŸ“‹ Kubernetes Version Utils:
âœ… K8s supported version check
âœ… K8s EOL version check
âœ… K8s latest version
âœ… K8s version validation (valid)
âœ… K8s version validation (invalid)

ğŸ“‹ Architecture Manager:
âœ… Architecture info retrieval
âœ… ARM64 architecture info
âœ… Instance type architecture detection (ARM64)
âœ… Instance type architecture detection (x86_64)
âœ… Instance type validation (compatible)
âœ… Instance type validation (incompatible)
âœ… GPU instance recommendations
âœ… NVIDIA repository config (ARM64)
âœ… Container platform string
âœ… Architecture labels
âœ… Legacy get_ami_types_for_architecture
âœ… Legacy get_nvidia_repo_path
âœ… Legacy normalize_architecture

ğŸ“‹ Instance Type Analyzer:
âœ… Instance type analysis (g5g.xlarge)
âœ… Instance type analysis (g5.xlarge)
âœ… Invalid instance type analysis
âœ… Instance type recommendations

ğŸ“‹ Template Validator:
âœ… Template validation (valid)
âœ… Template validation (invalid)
âœ… Template validation (wrong types)
âœ… Legacy validate_template function

ğŸ“‹ Template Merger:
âœ… Template merge (simple override)
âœ… Template merge (deep merge labels)
âœ… Architecture-specific overrides
âœ… Legacy merge_template_overrides function

ğŸ“‹ Template Loader:
âœ… Template loading
âœ… Validate and load template
âœ… Legacy load_template function
âœ… Create default template
âœ… Load non-existent template (error handling)

ğŸ“‹ Template Generator:
âœ… Workload-specific template (ml-training)
âœ… Workload-specific template (ml-inference)
âŒ Template generator tests: Error creating template file : [Errno 2] No such file or directory: ''

ğŸ“‹ Mixed Architecture Analysis:
âœ… Mixed architecture analysis
âœ… Single architecture analysis
âœ… Architecture mismatch detection

============================================================
TEST SUMMARY: 49/53 passed
FAILED TESTS:
  â€¢ Driver version parsing: Got 570.148.8
  â€¢ Clean version extraction: Expected '570.148.08', got '570.148.8'
  â€¢ Legacy parse_driver_version function: Got '570.148.8'
  â€¢ Template generator tests: Error creating template file : [Errno 2] No such file or directory: ''
============================================================
ğŸ’¥ Some Phase 3 tests failed!

âŒ PHASE 3 UTILITIES TESTS FAILED (0.1s)

============================================================
ğŸ§ª RUNNING INTEGRATION TESTS
============================================================
âœ… All module imports successful!
ğŸ§ª INTEGRATION TESTING - PHASES 1, 2, 3
============================================================
Testing how all refactored modules work together...

ğŸ”— AMI-First Workflow:
ğŸ”„ Testing AMI-first workflow integration...
âœ… AlignmentRequest validation
âœ… Architecture information retrieval
âœ… Kubernetes version validation
âœ… AMI type recommendation
âœ… DriverAlignment creation and validation
âœ… NodeGroup configuration generation
âœ… Architecture consistency verification
âœ… AWS CLI format generation
ğŸ“‹ Generated configuration preview:
   Cluster: test-cluster
   Nodegroup: gpu-workers-arm64
   AMI Type: AL2023_ARM_64_NVIDIA
   Instance Types: ['g5g.xlarge']
   Architecture: arm64

ğŸ”— Container-First Workflow:
ğŸ”„ Testing container-first workflow integration...
âŒ Driver version parsing: Expected 570.148.08, got 570.148.8

ğŸ”— Template Integration:
ğŸ”„ Testing template integration...
âœ… Workload template generation
âœ… Template to NodeGroupConfig conversion
âœ… Template override merging
âœ… Template file save/load cycle
âŒ Template integration: Error creating template file : [Errno 2] No such file or directory: ''

ğŸ”— Cross-Module Compatibility:
ğŸ”„ Testing cross-module compatibility...
âœ… AMI type consistency (x86_64)
âœ… AMI type consistency (arm64)
âœ… Version parsing round-trip (570.148.08-1.amzn2023)
âœ… Version parsing round-trip (560.35.05-1.ubuntu2204)
âœ… Version parsing round-trip (1.32.0)
âœ… Version parsing round-trip (1.31)
âœ… Architecture normalization consistency (amd64)
âœ… Architecture normalization consistency (x86_64)
âœ… Architecture normalization consistency (arm64)
âœ… Config serialization round-trip
âœ… Validation format consistency (DriverAlignment)
âœ… Validation format consistency (AlignmentRequest)
âœ… Validation format consistency (NodeGroupConfig)
ğŸ“‹ Cross-module compatibility verified:
   AMI type enums consistent across modules
   Version parsing round-trips work
   Architecture normalization consistent
   Configuration serialization reliable
   Error handling formats uniform

ğŸ”— Backward Compatibility:
ğŸ”„ Testing backward compatibility...
âŒ Legacy parse_driver_version: Got 570.148.8
âœ… Legacy compare_versions
âœ… Legacy sort_versions
âœ… Legacy get_ami_types_for_architecture
âœ… Legacy get_nvidia_repo_path
âœ… Legacy normalize_architecture
âœ… Legacy validate_template
âœ… Legacy merge_template_overrides
ğŸ“‹ Backward compatibility verified:
   All legacy functions work as expected
   API interfaces preserved
   Original behavior maintained

============================================================
INTEGRATION TEST SUMMARY: 32/35 passed
FAILED TESTS:
  â€¢ Driver version parsing: Expected 570.148.08, got 570.148.8
  â€¢ Template integration: Error creating template file : [Errno 2] No such file or directory: ''
  â€¢ Legacy parse_driver_version: Got 570.148.8
============================================================

ğŸ’¥ SOME INTEGRATION TESTS FAILED!
âŒ Fix these issues before proceeding to Phase 4

âŒ INTEGRATION TESTS FAILED (0.2s)

============================================================
ğŸ“Š FINAL TEST SUMMARY
============================================================
âŒ PHASE 2 MODELS TESTS
âŒ PHASE 3 UTILITIES TESTS
âŒ INTEGRATION TESTS

RESULTS: 0/3 test suites passed
DURATION: 0.3 seconds

ğŸ’¥ 3 TEST SUITE(S) FAILED!
âŒ Fix the failing tests before proceeding

Debugging tips:
1. Check import paths and module structure
2. Verify all required dependencies are available
3. Run individual test scripts for detailed error messages
4. Check Python path and module visibility
